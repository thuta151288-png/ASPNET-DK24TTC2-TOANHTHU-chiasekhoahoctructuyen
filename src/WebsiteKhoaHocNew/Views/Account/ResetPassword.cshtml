@model WebsiteKhoaHoc.ViewModels.ResetPasswordViewModel

@{
    ViewData["Title"] = "Đặt lại mật khẩu";
}

<div class="container" style="padding: 4rem 0;">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card border-0 shadow-lg" style="background: var(--bg-secondary); border-radius: 1rem; overflow: hidden;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div style="width: 60px; height: 60px; background: rgba(99, 102, 241, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                            <i class="fas fa-lock-open" style="font-size: 1.5rem; color: var(--primary-color);"></i>
                        </div>
                        <h2 style="font-weight: 700; color: var(--text-primary);">Đặt lại mật khẩu</h2>
                        <p style="color: var(--text-secondary);">Nhập mật khẩu mới cho tài khoản của bạn.</p>
                    </div>

                    <form asp-action="ResetPassword" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                        <input asp-for="Token" type="hidden" />
                        <input asp-for="Email" type="hidden" /> <!-- Assuming email is passed via query string or handled differently, but usually it's good to confirm email or just rely on token if it contains user info. However, Identity's ResetPasswordAsync needs user, token, and password. Finding user by email is standard. -->
                        <!-- Wait, the ResetPassword link usually contains userId and code. 
                             My controller action ResetPassword(string code) only takes code. 
                             I need to make sure I capture the user ID or email. 
                             The link I generated was: Url.Action("ResetPassword", "Account", new { userId = user.Id, code = code }, ...);
                             So the GET action receives userId and code.
                             Let me double check my controller.
                        -->
                        
                        <div class="mb-3">
                             <!-- If I don't ask for email again, I need to pass it from the link or hidden field. 
                                  Standard Identity flow often asks for Email + Password + ConfirmPassword + Token (hidden).
                                  Or the link has userId, and we find user by ID, then use that user to reset.
                                  But ResetPasswordAsync takes 'user' object.
                                  Let's check the controller again.
                             -->
                             <label asp-for="Email" class="form-label">Email xác nhận</label>
                             <div class="input-group">
                                <span class="input-group-text" style="background: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-muted);">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input asp-for="Email" class="form-control" placeholder="name@example.com" />
                            </div>
                            <span asp-validation-for="Email" class="text-danger" style="font-size: 0.875rem;"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Password" class="form-label">Mật khẩu mới</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-muted);">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input asp-for="Password" class="form-control" placeholder="••••••••" />
                            </div>
                            <span asp-validation-for="Password" class="text-danger" style="font-size: 0.875rem;"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="ConfirmPassword" class="form-label">Xác nhận mật khẩu</label>
                            <div class="input-group">
                                <span class="input-group-text" style="background: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-muted);">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                                <input asp-for="ConfirmPassword" class="form-control" placeholder="••••••••" />
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger" style="font-size: 0.875rem;"></span>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 py-2" style="border-radius: 0.5rem;">
                            <i class="fas fa-save me-2"></i> Đổi mật khẩu
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
