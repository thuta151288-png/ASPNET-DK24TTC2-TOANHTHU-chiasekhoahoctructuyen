@model Course

@{
    ViewData["Title"] = "Chỉnh sửa khóa học";
}

<div class="container" style="padding: 3rem 0;">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h1>
                <i class="fas fa-edit"></i> Chỉnh Sửa Khóa Học
            </h1>
            <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                ID: <code style="background: var(--bg-tertiary); padding: 0.25rem 0.5rem; border-radius: 4px;">@Model.Id</code>
            </p>
        </div>
        <a asp-controller="Lessons" asp-action="Index" asp-route-courseId="@Model.Id" class="btn btn-secondary">
            <i class="fas fa-video"></i> Quản Lý Bài Học
        </a>
    </div>

    <!-- Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body" style="padding: 2rem;">
                    <form asp-action="Edit" method="post" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="CreatedAt" />
                        <input type="hidden" asp-for="CoverImage" />

                        <!-- Basic Info -->
                        <h5 style="margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color);">
                            <i class="fas fa-info-circle"></i> Thông tin cơ bản
                        </h5>

                        <div class="mb-3">
                            <label asp-for="Title" class="form-label">
                                <i class="fas fa-heading"></i> Tiêu đề khóa học <span style="color: var(--error-color);">*</span>
                            </label>
                            <input asp-for="Title" class="form-control" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Description" class="form-label">
                                <i class="fas fa-align-left"></i> Mô tả <span style="color: var(--error-color);">*</span>
                            </label>
                            <textarea asp-for="Description" class="form-control" rows="5"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Price" class="form-label">
                                    <i class="fas fa-tag"></i> Giá (VNĐ) <span style="color: var(--error-color);">*</span>
                                </label>
                                <input asp-for="Price" type="number" class="form-control" min="0" step="1000" />
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="CategoryId" class="form-label">
                                    <i class="fas fa-folder"></i> Danh mục <span style="color: var(--error-color);">*</span>
                                </label>
                                <select asp-for="CategoryId" class="form-select" asp-items="ViewBag.CategoryId"></select>
                                <span asp-validation-for="CategoryId" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Status" class="form-label">
                                <i class="fas fa-toggle-on"></i> Trạng thái <span style="color: var(--error-color);">*</span>
                            </label>
                            <select asp-for="Status" class="form-select">
                                <option value="0">Nháp (Draft)</option>
                                <option value="1">Đã xuất bản (Published)</option>
                            </select>
                            <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                                <i class="fas fa-info-circle"></i> 
                                Chỉ khóa học "Đã xuất bản" mới hiển thị cho học viên
                            </small>
                            <span asp-validation-for="Status" class="text-danger"></span>
                        </div>

                        <!-- Cover Image -->
                        <h5 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color);">
                            <i class="fas fa-image"></i> Ảnh bìa
                        </h5>

                        @if (!string.IsNullOrEmpty(Model.CoverImage))
                        {
                            <div style="margin-bottom: 1rem;">
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <strong>Ảnh hiện tại:</strong>
                                </p>
                                <img src="@Model.CoverImage" alt="@Model.Title" 
                                     style="max-width: 100%; height: auto; border-radius: var(--radius-lg); border: 1px solid var(--border-color);" />
                            </div>
                        }

                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-upload"></i> Tải ảnh bìa mới
                            </label>
                            <input type="file" name="coverImage" class="form-control" accept="image/*" />
                            <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">
                                <i class="fas fa-info-circle"></i> 
                                Để trống nếu không muốn thay đổi. Khuyến nghị: 1200x600px, JPG/PNG
                            </small>
                        </div>

                        <!-- Instructor Info -->
                        <h5 style="margin: 2rem 0 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--border-color);">
                            <i class="fas fa-chalkboard-teacher"></i> Thông tin giảng viên
                        </h5>

                        <div class="mb-3">
                            <label asp-for="InstructorName" class="form-label">
                                <i class="fas fa-user"></i> Tên giảng viên <span style="color: var(--error-color);">*</span>
                            </label>
                            <input asp-for="InstructorName" class="form-control" />
                            <span asp-validation-for="InstructorName" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="InstructorBio" class="form-label">
                                <i class="fas fa-id-card"></i> Tiểu sử giảng viên
                            </label>
                            <textarea asp-for="InstructorBio" class="form-control" rows="3"></textarea>
                            <span asp-validation-for="InstructorBio" class="text-danger"></span>
                        </div>

                        <!-- Actions -->
                        <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Cập Nhật
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Quay Lại
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Stats -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-body">
                    <h5 style="margin-bottom: 1rem;">
                        <i class="fas fa-chart-bar"></i> Thống kê
                    </h5>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        <p style="margin-bottom: 0.5rem;">
                            <strong>Số bài học:</strong> @(Model.Lessons?.Count ?? 0)
                        </p>
                        <p style="margin-bottom: 0.5rem;">
                            <strong>Ngày tạo:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy")
                        </p>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <p style="margin-bottom: 0.5rem;">
                                <strong>Cập nhật:</strong> @Model.UpdatedAt.Value.ToString("dd/MM/yyyy")
                            </p>
                        }
                        <p style="margin-bottom: 0;">
                            <strong>Trạng thái:</strong>
                            @switch (Model.Status)
                            {
                                case CourseStatus.Draft:
                                    <span class="badge" style="background: var(--text-muted);">Nháp</span>
                                    break;
                                case CourseStatus.Published:
                                    <span class="badge badge-success">Đã xuất bản</span>
                                    break;
                            }
                        </p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card" style="margin-bottom: 1.5rem;">
                <div class="card-body">
                    <h5 style="margin-bottom: 1rem;">
                        <i class="fas fa-bolt"></i> Thao tác nhanh
                    </h5>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <a asp-controller="Lessons" asp-action="Index" asp-route-courseId="@Model.Id" 
                           class="btn btn-secondary" style="width: 100%;">
                            <i class="fas fa-list"></i> Xem bài học
                        </a>
                        <a asp-controller="Lessons" asp-action="Create" asp-route-courseId="@Model.Id" 
                           class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-plus"></i> Thêm bài học
                        </a>
                        <a asp-controller="Courses" asp-action="Details" asp-route-id="@Model.Id" asp-area="" 
                           class="btn btn-secondary" style="width: 100%;" target="_blank">
                            <i class="fas fa-eye"></i> Xem trang công khai
                        </a>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="card" style="border-color: var(--error-color);">
                <div class="card-body">
                    <h5 style="margin-bottom: 1rem; color: var(--error-color);">
                        <i class="fas fa-exclamation-triangle"></i> Vùng nguy hiểm
                    </h5>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                        Xóa khóa học sẽ xóa tất cả bài học và dữ liệu liên quan. Hành động này không thể hoàn tác!
                    </p>
                    <form asp-action="Delete" asp-route-id="@Model.Id" method="post"
                          onsubmit="return confirm('⚠️ BẠN CÓ CHẮC CHẮN?\n\nXóa khóa học sẽ xóa:\n- Tất cả bài học\n- Dữ liệu tiến độ học viên\n- Đánh giá\n\nHành động này KHÔNG THỂ HOÀN TÁC!');">
                        <button type="submit" class="btn btn-danger" style="width: 100%;">
                            <i class="fas fa-trash"></i> Xóa Khóa Học
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
